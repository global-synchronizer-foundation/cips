# CIP 0086

<pre>
  CIP: CIP 0086  
  Title: ERC-20 Middleware and Distributed Indexer for Canton Network  
  Author: ChainSafe Systems  
  Status: Draft  
  Type: Standards Track  
  Created: 2025-10-14  
  License: CC0-1.0
</pre>

---

## Abstract

This CIP proposes the development of an ERC-20-compatible middleware and distributed indexer for the Canton Network. The goal is to enable Ethereum-style token operations—such as those for stablecoins, tokenized assets, and liquidity tokens—to operate natively within Canton’s privacy-preserving distributed ledger architecture, while maintaining alignment with Ethereum’s dominant ERC-20 standard.

The middleware will translate Canton’s UTXO-based smart contract semantics and participant-specific data visibility into familiar ERC-20 API calls. A distributed indexer service will provide globally or locally accurate state aggregation, depending on the operator’s visibility scope.

---

## Motivation

Canton’s ledger model prioritizes privacy and fine-grained access control. While this model ensures compliance and data isolation, it also creates interoperability challenges for external developers accustomed to Ethereum-like interfaces. Many DeFi, stablecoin, and token infrastructure tools are designed for ERC-20 semantics and cannot directly interoperate with Canton’s data structures.

By introducing a privacy-aware ERC-20 middleware and indexer layer:

* Canton gains immediate interoperability with existing token tooling, SDKs, and integrations.  
* Token issuers can onboard existing ERC-20 assets with minimal integration overhead.  
* Super Validators (SVs) and issuers can provide standardized APIs to wallets, explorers, and DeFi protocols.  
* The developer experience is dramatically simplified, while maintaining Canton’s core privacy and security guarantees.

This proposal aligns with the broader Canton roadmap to support regulated, composable finance while ensuring cross-ecosystem compatibility.

---

## Specification

| # | Decision / Deliverable | Scope / What Must Be True | Parameter / Target | Notes & Acceptance |
|---|-------------------------|---------------------------|--------------------|--------------------|
| S1 | **ERC-20 Middleware Architecture** | Design and implement middleware translating ERC-20 operations into Canton Ledger API transactions. | ERC-20 API (transfer, approve, transferFrom, balanceOf, allowance, totalSupply). | Must support full and scoped visibility modes. |
| S2 | **Distributed Indexer Service** | Indexes token events (issuances, transfers, burns) from the Canton Ledger. | PostgreSQL or equivalent; deterministic UTXO aggregation. | Exposes standardized query endpoints. |
| S3 | **Token Template Implementation** | Implement ERC20Token Daml template conforming to the Canton Token Standard (CIP-56). | Includes AllowanceContract for approve/transferFrom. | Supports governance-restricted mint/burn. |
| S4 | **Security & Privacy Model** | Define operation constraints for issuer, validator, and end-user modes. | Full vs Scoped visibility; identity & session management. | Enforces Canton’s privacy guarantees. |
| S5 | **Phase 1 Deliverables** | ERC-20 Middleware & Indexer for Canton Coin. | Architecture doc, Daml contracts, middleware, indexer, tests, docs. | Delivery within 180 days of approval. |
| S6 | **Phase 2 Generalization** | Define ERC20Compatible Daml interface abstraction supporting multiple tokens. | Token-agnostic middleware and indexer. | Future CIP to standardize interface. |
| S7 | **Phase 3 Governance Proposal** | Submit formal CIP defining ERC-20 compatibility as a network standard. | Collaboration with the Global Synchronizer Foundation. | Target validator-grade deployment. |
| S8 | **Super Validator Application** | ChainSafe to operate as SV with weight 5 upon successful delivery. | Weight increases tied to milestones. | Rewards per delivery and adoption. |

---

## Rationale

Ethereum’s ERC-20 interface has become a de-facto industry standard. To ensure Canton’s interoperability with global token infrastructure, providing an ERC-20-compatible layer allows developers to interact with Canton tokens using familiar paradigms.

However, Canton’s privacy model prevents direct replication of Ethereum’s open-state model. The middleware-indexer architecture proposed herein abstracts these differences while preserving compliance and confidentiality.  
A two-tier visibility approach—**Full Visibility (validator-operated)** and **Scoped Visibility (issuer or user-operated)**—allows flexible deployment across asset types.

This incremental, three-phase plan ensures early utility, extensibility, and eventual formalization through governance.

---

## Phased Implementation Plan

### **Phase 1 — ERC-20 Middleware & Indexer for Canton Coin**

Develop a full ERC-20 interface middleware and distributed indexer supporting a Canton Coin-compliant token.

**Deliverables**

1. **Architecture & Design Documentation**  
   * Ledger-middleware-indexer system diagram.  
   * API schemas (OpenAPI or gRPC).  
   * Security and privacy model.

2. **Daml ERC-20 Token Template**  
   * Implements ERC-20 semantics under Canton’s Token Standard.  
   * On-ledger governance for mint/burn, authorization checks, and transfer conditions.  
   * Tested on Canton devnet.

3. **Middleware Service**  
   * Stateless ERC-20 API (REST/gRPC).  
   * Transaction orchestration and session management.  
   * Contract state resolution with UTXO optimization.  
   * IaC for deployment and observability.

4. **Indexer Backend**  
   * Rust-based indexer consuming Ledger API events.  
   * SQL storage for balance/allowance state.  
   * Deterministic reconciliation logic.

5. **Integration & Demo**  
   * Automated test suite and mock front-end demonstrating ERC-20 functionality.

6. **Documentation & User Guide**  
   * Developer integration manual and API reference.

**Estimated Duration:** ~12 weeks total  
**Acceptance:** Client review within 10 days of delivery; absence of written deficiencies = acceptance.

---

### **Phase 2 — Interface Abstraction & Multi-Token Enablement**

Refactor middleware and indexer for token-agnostic operation using a formal **ERC20Compatible** Daml interface.  
This phase establishes a universal ERC-20 compatibility layer applicable to any Canton Token Standard-compliant asset.

Deliverables and budget to be scoped post-Phase 1, based on architectural learnings.

---

### **Phase 3 — Canton Improvement Proposal & Validator Deployment**

Propose a formal **CIP** standardizing the ERC-20 compatibility interface for the network.  
Super Validators (SVs) will operate middleware nodes as canonical infrastructure for ERC-20-compatible tokens, including Canton Coin.  
Coordination will occur with the Global Synchronizer Foundation and governance bodies to align on standards, security, and lifecycle management.

---

## Economic and Incentive Model

ChainSafe will apply for **Super Validator (SV)** status with weight 5 upon successful delivery.

| Deliverable | Acceptance Criteria | Deadline | Weight Earned |
|--------------|--------------------|-----------|----------------|
| ERC-20 Middleware MVP | Middleware live on MainNet; first EVM-compatible token transacting on Canton via ChainSafe middleware. | +180 days from CIP approval | +1 |
| Acceleration Bonus | +2 if delivered ≤ 60 days; +0 if > 180 days (linear scale). | ≤ 180 days | Up to +2 |
| Adoption Bonus | +0.5 per asset with > $10M TVL issued on MainNet (≤ +2 max). | 180 days post-launch | Up to +2 |

---

## Security Considerations

* Middleware and indexer must operate within Canton’s confidentiality guarantees.  
* Only authorized operators (issuers, validators) may deploy full-visibility instances.  
* All deployments must employ authenticated API access, audited code paths, and observability for anomaly detection.  
* Private data leakage must be prevented via access-scoped queries and enforced data-visibility boundaries.

---

## Backwards Compatibility

This proposal adds new middleware and indexer infrastructure but does not modify the Canton ledger, core protocol rules, or token semantics.  
All existing Daml templates and token contracts remain compatible.

---

## Governance and Reporting

Quarterly progress reports and milestone demonstrations will be published to the Canton community.  
Upon completion, the middleware and indexer source code will be open-sourced under a permissive license within a Foundation-controlled repository.

---

## Copyright

This CIP is licensed under **CC0-1.0**: [Creative Commons CC0 1.0 Universal](https://creativecommons.org/publicdomain/zero/1.0/)

---

## Changelog

* **2025-09-11:** Initial draft prepared by ChainSafe Systems.  
* **2025-10-14:** Submitted to Canton Governance for review.
